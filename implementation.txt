【server.py の実装概要】

1. Flask アプリケーションと Flask-SocketIO を利用した管理サーバ：
　- Flask により管理用のWeb UI（管理ダッシュボード）やREST APIエンドポイントを提供。
　- Flask-SocketIO により、WebSocket通信を実現し、エージェントからの接続、ハンドシェイク、監視データの受信、ならびに監視対象リストのプッシュ更新を行う。

2. SQLite データベースによるエージェント情報と監視データの管理：
　- DB テーブル Agent では、仮登録時の情報（パスフレーズ、ホスト名、IPアドレス、バージョン）や承認状態、エージェントIDを保存。
　- MonitoringData テーブルには、各エージェントから5秒毎に受信した監視結果（対象、時刻、結果、遅延値）が記録される。
　- さらに、直近1時間分の監視データをメモリ上のキャッシュに保持し、高速なレスポンスを図っている。

3. エージェント登録・認証の処理：
　- WebSocketネームスペース（/agent）でクライアントの接続を待機し、エージェントからのハンドシェイクメッセージを受信する。
　- ハンドシェイク時に送信されたパスフレーズ、ホスト名、IPアドレス、バージョンに基づいて仮登録を実施し、管理者の承認待ち状態にする。
　- 承認済みエージェントについては、接続後に監視対象リストをプッシュして、エージェントとの継続的な通信を確立する。

4. 監視対象リストの一元管理とプッシュ更新：  
　- 管理者は管理ダッシュボード上の「監視対象リスト管理」ページから、対象IPの編集、追加、削除が可能です。  
　- 入力された監視対象リストはカンマ区切りで処理され、更新後は全エージェントへ WebSocket を通じてプッシュ配信されます。

【agent.go の実装概要】

1. Go言語によるエージェント実装：
　- エージェントは、起動時に管理サーバの WebSocket エンドポイントに接続し、ハンドシェイクメッセージを送信する。
　- ハンドシェイクメッセージには、サーバ発行のパスフレーズ、ホスト名、IPアドレス、バージョンが含まれ、サーバより登録状態のレスポンスを受け取る。

2. 監視対象リストの管理：
　- 本登録が完了したエージェントは、初回接続時または再接続時に管理サーバから監視対象リストを受信する。
　- サーバからの WebSocket のプッシュメッセージにより、監視対象リストが動的に更新される仕組みを実装している。

3. ICMP監視の実装：
　- Go の “golang.org/x/net/icmp” および “golang.org/x/net/ipv4” パッケージを用いて、指定された各監視対象へ定期的（5秒毎）にICMPエコーリクエストを送信。
　- 各対象への応答状況や応答時間（RTT）を取得し、結果を集計する。
　- 送信失敗時には、後からまとめて再送を試みるためのバッファリングも実施している。

4. 監視データの送信：
　- 監視対象への各監視結果のデータは、管理サーバに対し WebSocket 経由で送信される。
　- 送信失敗時は、バッファに保持して、後続の処理で再送を試行する仕組みを取り入れている。

　- エージェントはサーバからプッシュされる監視対象リストの更新を受信し、動的に監視対象を変更します。

両ファイル間では、サーバが中央制御として監視対象リストの一元更新およびエージェントの登録管理を行い、エージェントは動的に受信した対象リストに基づいてネットワーク監視を実施するという設計になっています。